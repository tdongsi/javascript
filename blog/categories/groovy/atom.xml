<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Groovy | Archived Blog Posts]]></title>
  <link href="http://tdongsi.github.io/javascript/blog/categories/groovy/atom.xml" rel="self"/>
  <link href="http://tdongsi.github.io/javascript/"/>
  <updated>2021-03-11T15:03:36-08:00</updated>
  <id>http://tdongsi.github.io/javascript/</id>
  <author>
    <name><![CDATA[Cuong Dong-Si]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Job DSL Plugin in Jenkins]]></title>
    <link href="http://tdongsi.github.io/javascript/blog/2016/10/30/job-dsl-plugin-in-jenkins/"/>
    <updated>2016-10-30T18:27:07-07:00</updated>
    <id>http://tdongsi.github.io/javascript/blog/2016/10/30/job-dsl-plugin-in-jenkins</id>
    <content type="html"><![CDATA[<p>How Job DSL plugin works and why it is losing its dominance to Jenkins Pipeline.</p>

<!--more-->


<h3>Job DSL</h3>

<pre><code class="groovy Minimal Job DSL">job('Demo') {
    description("Starting pipeline")
    logRotator {
        daysToKeep(15)
    }
    steps {
        shell('echo "Hello World"')
    } 
}
</code></pre>

<p>To illustrate the idea.
Obviously, lots of work need to be done to make sure the final generated <code>config.xml</code> is valid, including escaping special characters.</p>

<pre><code class="groovy Simple implementation of Job DSL">class GroovyDsl {

    def description(String description) {
        print '&lt;description&gt;'
        print description
        println '&lt;/description&gt;'
    }

    def logRotator(Closure inner) {
        println '&lt;logRotator&gt;'
        inner()
        println '&lt;/logRotator&gt;'
    }

    def steps(Closure inner) {
        println '&lt;builders&gt;'
        inner()
        println '&lt;/builders&gt;'
    }

    static void job(String name, Closure closure) {
        GroovyDsl body = new GroovyDsl()

        println "Generating a Freestyle job $name"
        println "Save the following into config.xml file"
        println '&lt;project&gt;'
        body.with(closure)
        println '&lt;/project&gt;'
    }

}

def daysToKeep(int num) {
    println "&lt;daysToKeep&gt;$num&lt;/daysToKeep&gt;"
    println '&lt;numToKeep&gt;-1&lt;/numToKeep&gt;'
    println '&lt;artifactDaysToKeep&gt;-1&lt;/artifactDaysToKeep&gt;'
    println '&lt;artifactNumToKeep&gt;-1&lt;/artifactNumToKeep&gt;'
}

def shell(String cmd) {
    println '&lt;hudson.tasks.Shell&gt;'
    println '&lt;command&gt;'
    println cmd
    println '&lt;/command&gt;'
    println '&lt;/hudson.tasks.Shell&gt;'
}

GroovyDsl.job('Demo') {
    description("Starting pipeline")
    logRotator {
        daysToKeep(15)
    }
    steps {
        shell('echo "Hello World"')
    } 
}
</code></pre>

<pre><code class="xml Output of the above script">Generating a Freestyle job Demo
Save the following into config.xml file
&lt;project&gt;
&lt;description&gt;Starting pipeline&lt;/description&gt;
&lt;logRotator&gt;
&lt;daysToKeep&gt;15&lt;/daysToKeep&gt;
&lt;numToKeep&gt;-1&lt;/numToKeep&gt;
&lt;artifactDaysToKeep&gt;-1&lt;/artifactDaysToKeep&gt;
&lt;artifactNumToKeep&gt;-1&lt;/artifactNumToKeep&gt;
&lt;/logRotator&gt;
&lt;builders&gt;
&lt;hudson.tasks.Shell&gt;
&lt;command&gt;
echo "Hello World"
&lt;/command&gt;
&lt;/hudson.tasks.Shell&gt;
&lt;/builders&gt;
&lt;/project&gt;
</code></pre>

<p>Compared with the Jenkins config.xml of the Freestyle job generated by the same Job DSL, we can see that there is not much different.</p>

<pre><code class="xml Output of config.xml in Jenkins">&lt;project&gt;
&lt;actions/&gt;
&lt;description&gt;Starting pipeline&lt;/description&gt;
&lt;keepDependencies&gt;false&lt;/keepDependencies&gt;
&lt;properties/&gt;
&lt;scm class="hudson.scm.NullSCM"/&gt;
&lt;canRoam&gt;true&lt;/canRoam&gt;
&lt;disabled&gt;false&lt;/disabled&gt;
&lt;blockBuildWhenDownstreamBuilding&gt;false&lt;/blockBuildWhenDownstreamBuilding&gt;
&lt;blockBuildWhenUpstreamBuilding&gt;false&lt;/blockBuildWhenUpstreamBuilding&gt;
&lt;triggers/&gt;
&lt;concurrentBuild&gt;false&lt;/concurrentBuild&gt;
&lt;builders&gt;
&lt;hudson.tasks.Shell&gt;
&lt;command&gt;echo "Hello World"&lt;/command&gt;
&lt;/hudson.tasks.Shell&gt;
&lt;/builders&gt;
&lt;publishers/&gt;
&lt;buildWrappers/&gt;
&lt;logRotator&gt;
&lt;daysToKeep&gt;15&lt;/daysToKeep&gt;
&lt;numToKeep&gt;-1&lt;/numToKeep&gt;
&lt;artifactDaysToKeep&gt;-1&lt;/artifactDaysToKeep&gt;
&lt;artifactNumToKeep&gt;-1&lt;/artifactNumToKeep&gt;
&lt;/logRotator&gt;
&lt;/project&gt;
</code></pre>
]]></content>
  </entry>
  
</feed>
